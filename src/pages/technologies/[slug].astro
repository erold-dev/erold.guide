---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getTechnologies, getTechnology, getTopicsByTechnology, getGuidelinesByTopic } from '../../lib/content';

export function getStaticPaths() {
  const technologies = getTechnologies();
  return technologies.map(tech => ({
    params: { slug: tech.slug },
    props: { technology: tech },
  }));
}

const { slug } = Astro.params;
const technology = getTechnology(slug);

if (!technology) {
  return Astro.redirect('/404');
}

const topics = getTopicsByTechnology(slug).map(topic => ({
  ...topic,
  guidelinesCount: getGuidelinesByTopic(topic.slug).length,
}));

const totalGuidelines = topics.reduce((sum, t) => sum + t.guidelinesCount, 0);
---

<BaseLayout title={technology.name} description={technology.description}>
  <main id="main-content" class="mx-auto max-w-6xl px-4 py-12 sm:px-6">

    <!-- Header -->
    <div class="mb-12">
      <nav class="text-sm font-mono mb-4" style="color: var(--text-muted);" aria-label="Breadcrumb">
        <a href="/" class="hover:underline" style="color: var(--text-secondary);">Home</a>
        <span class="mx-2">/</span>
        <a href="/technologies" class="hover:underline" style="color: var(--text-secondary);">Technologies</a>
        <span class="mx-2">/</span>
        <span style="color: var(--text-primary);">{technology.name}</span>
      </nav>

      <div class="flex items-start gap-6">
        {technology.logo && (
          <div class="flex-shrink-0 w-16 h-16 rounded-xl p-3 surface">
            <img src={technology.logo} alt="" class="w-full h-full object-contain" aria-hidden="true" />
          </div>
        )}
        <div>
          <h1 class="text-3xl font-bold tracking-tight mb-2" style="color: var(--text-primary);">{technology.name}</h1>
          <p class="text-lg max-w-2xl" style="color: var(--text-muted);">
            {technology.description}
          </p>
        </div>
      </div>

      {technology.paradigms && technology.paradigms.length > 0 && (
        <div class="flex flex-wrap gap-2 mt-4">
          {technology.paradigms.map(paradigm => (
            <span class="badge">{paradigm}</span>
          ))}
        </div>
      )}

      <div class="flex items-center gap-4 mt-6">
        {technology.website && (
          <a
            href={technology.website}
            target="_blank"
            rel="noopener noreferrer"
            class="btn btn-secondary text-sm"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
            </svg>
            Website
          </a>
        )}
        {technology.documentation && (
          <a
            href={technology.documentation}
            target="_blank"
            rel="noopener noreferrer"
            class="btn btn-secondary text-sm"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
            </svg>
            Documentation
          </a>
        )}
      </div>
    </div>

    <!-- Quick Stats -->
    <div class="quick-stats mb-12">
      <div class="quick-stat">
        <span class="quick-stat-value">{topics.length}</span>
        <span class="quick-stat-label">Topics</span>
      </div>
      <div class="quick-stat-divider"></div>
      <div class="quick-stat">
        <span class="quick-stat-value">{totalGuidelines}</span>
        <span class="quick-stat-label">Guidelines</span>
      </div>
    </div>

    <!-- Topics Grid -->
    <section aria-labelledby="topics-heading">
      <h2 id="topics-heading" class="text-xl font-bold mb-6" style="color: var(--text-primary);">
        {technology.name} Topics
      </h2>

      {topics.length > 0 ? (
        <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
          {topics.map((topic) => (
            <a href={`/topics/${topic.slug}`} class="framework-card">
              <div class="framework-card-header">
                <div class="framework-card-icon">
                  {topic.logo ? (
                    <img src={topic.logo} alt="" aria-hidden="true" />
                  ) : (
                    <span class="text-xl font-bold" style="color: var(--text-primary);" aria-hidden="true">{topic.name.charAt(0)}</span>
                  )}
                </div>
                <div>
                  <div class="framework-card-title">{topic.name}</div>
                  <div class="framework-card-tech">{topic.type}</div>
                </div>
              </div>

              <p class="framework-card-desc">{topic.description}</p>

              <div class="framework-card-footer">
                <div class="framework-card-stat">
                  <span class="framework-card-stat-value">{topic.guidelinesCount}</span>
                  <span class="framework-card-stat-label">guidelines</span>
                </div>
                {topic.currentVersion && (
                  <span class="text-xs font-mono px-2 py-1 rounded" style="background: var(--bg-tertiary); color: var(--accent-primary);">
                    v{topic.currentVersion}
                  </span>
                )}
              </div>
            </a>
          ))}
        </div>
      ) : (
        <div class="empty-state">
          <div class="empty-state-icon" aria-hidden="true">
            <svg class="w-8 h-8" style="color: var(--text-muted);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
            </svg>
          </div>
          <div class="empty-state-title">No topics yet</div>
          <div class="empty-state-desc">
            No topics have been added for {technology.name} yet.
          </div>
        </div>
      )}
    </section>

  </main>
</BaseLayout>
