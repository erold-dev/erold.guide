---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getTopics, getGuidelinesByTopic } from '../../lib/content';

const topics = getTopics().map(topic => ({
  ...topic,
  guidelinesCount: getGuidelinesByTopic(topic.slug).length,
}));

const totalGuidelines = topics.reduce((sum, t) => sum + t.guidelinesCount, 0);
---

<BaseLayout title="Topics">
  <main id="main-content" class="mx-auto max-w-6xl px-4 py-12 sm:px-6">

    <!-- Header -->
    <div class="mb-12">
      <nav class="text-sm font-mono mb-4" style="color: var(--text-muted);" aria-label="Breadcrumb">
        <a href="/" class="hover:underline" style="color: var(--text-secondary);">Home</a>
        <span class="mx-2">/</span>
        <span style="color: var(--text-primary);">Topics</span>
      </nav>

      <h1 class="text-3xl font-bold tracking-tight mb-3" style="color: var(--text-primary);">Topics</h1>
      <p class="text-lg max-w-2xl" style="color: var(--text-muted);">
        Browse development guidelines by topic.
        Topics include frameworks, libraries, concepts, tools, and practices.
      </p>
    </div>

    <!-- Quick Stats -->
    <div class="quick-stats mb-12">
      <div class="quick-stat">
        <span class="quick-stat-value">{topics.length}</span>
        <span class="quick-stat-label">Topics</span>
      </div>
      <div class="quick-stat-divider"></div>
      <div class="quick-stat">
        <span class="quick-stat-value">{totalGuidelines}</span>
        <span class="quick-stat-label">Total Guidelines</span>
      </div>
    </div>

    <!-- Topic Grid -->
    <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
      {topics.map((topic) => (
        <a href={`/topics/${topic.slug}`} class="framework-card">
          <div class="framework-card-header">
            <div class="framework-card-icon">
              {topic.logo ? (
                <img src={topic.logo} alt="" aria-hidden="true" />
              ) : (
                <span class="text-xl font-bold" style="color: var(--text-primary);" aria-hidden="true">{topic.name.charAt(0)}</span>
              )}
            </div>
            <div>
              <div class="framework-card-title">{topic.name}</div>
              {topic.technology && <div class="framework-card-tech">{topic.technology}</div>}
            </div>
          </div>

          <p class="framework-card-desc">{topic.description}</p>

          {topic.tags && topic.tags.length > 0 && (
            <div class="flex flex-wrap gap-1.5 mt-3">
              {topic.tags.slice(0, 3).map(tag => (
                <span class="badge text-xs">{tag}</span>
              ))}
            </div>
          )}

          <div class="framework-card-footer">
            <div class="framework-card-stat">
              <span class="framework-card-stat-value">{topic.guidelinesCount}</span>
              <span class="framework-card-stat-label">guidelines</span>
            </div>
            {topic.currentVersion && (
              <span class="text-xs font-mono px-2 py-1 rounded" style="background: var(--bg-tertiary); color: var(--accent-primary);">
                v{topic.currentVersion}
              </span>
            )}
          </div>
        </a>
      ))}
    </div>

    {topics.length === 0 && (
      <div class="empty-state">
        <div class="empty-state-icon" aria-hidden="true">
          <svg class="w-8 h-8" style="color: var(--text-muted);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
          </svg>
        </div>
        <div class="empty-state-title">No topics yet</div>
        <div class="empty-state-desc">
          Add topic YAML files to content/topics/ or contribute guidelines to get started.
        </div>
      </div>
    )}

  </main>
</BaseLayout>
