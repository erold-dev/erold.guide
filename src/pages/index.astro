---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getFrameworks, getGuidelines, getGuidelinesByFramework, getAllCategories, getAllTags } from '../lib/content';

const allFrameworks = getFrameworks();
const allGuidelines = getGuidelines();

const frameworks = allFrameworks.map(fw => ({
  name: fw.name,
  slug: fw.slug,
  count: getGuidelinesByFramework(fw.slug).length,
}));

const recentGuidelines = allGuidelines
  .sort((a, b) => new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime())
  .slice(0, 5)
  .map(g => ({
    title: g.title,
    framework: g.framework,
    category: g.category,
    slug: g.slug,
  }));

const categories = getAllCategories().slice(0, 6).map(c => ({
  name: c.name.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
  slug: c.name,
  count: c.count,
}));

const stats = {
  guidelines: allGuidelines.length,
  frameworks: allFrameworks.length,
  tags: getAllTags().length,
};
---

<BaseLayout title="Guidelines">
  <div class="mx-auto max-w-6xl px-4 py-8 sm:px-6">
    <!-- Header -->
    <div class="mb-8 pb-6 border-b border-[--color-terminal-border]">
      <h1 class="text-2xl font-mono font-bold text-white mb-2">Development Guidelines</h1>
      <p class="font-mono text-sm" style="color: var(--color-terminal-muted);">
        Open encyclopedia of best practices. <a href="/api" class="text-[--color-primary-400] hover:underline">API available</a> for programmatic access.
      </p>
    </div>

    <div class="grid lg:grid-cols-[1fr,300px] gap-8">
      <!-- Main Content -->
      <div class="space-y-8">
        <!-- Search -->
        <div>
          <input
            type="text"
            placeholder="Search guidelines..."
            class="w-full px-4 py-3 rounded-lg font-mono text-sm outline-none transition-all"
            style="background: var(--color-terminal-surface); border: 1px solid var(--color-terminal-border); color: var(--color-terminal-text);"
            id="search-input"
          />
        </div>

        <!-- Frameworks -->
        <section>
          <h2 class="font-mono text-xs uppercase tracking-wider mb-4" style="color: var(--color-terminal-comment);">
            Frameworks
          </h2>
          <div class="grid grid-cols-2 sm:grid-cols-4 gap-2">
            {frameworks.map((fw) => (
              <a
                href={`/frameworks/${fw.slug}`}
                class="flex items-center justify-between px-3 py-2 rounded font-mono text-sm transition-colors hover:bg-[--color-terminal-surface]"
                style="color: var(--color-terminal-text);"
              >
                <span>{fw.name}</span>
                <span class="text-xs" style="color: var(--color-terminal-muted);">{fw.count}</span>
              </a>
            ))}
          </div>
          <a href="/frameworks" class="inline-block mt-3 font-mono text-xs text-[--color-primary-400] hover:underline">
            All frameworks →
          </a>
        </section>

        <!-- Recent Guidelines -->
        <section>
          <h2 class="font-mono text-xs uppercase tracking-wider mb-4" style="color: var(--color-terminal-comment);">
            Recent Guidelines
          </h2>
          <div class="space-y-1">
            {recentGuidelines.map((g) => (
              <a
                href={`/guidelines/${g.framework}/${g.category}/${g.slug}`}
                class="flex items-center gap-3 px-3 py-2 rounded font-mono text-sm transition-colors hover:bg-[--color-terminal-surface]"
              >
                <span class="text-[--color-primary-400]">{g.framework}</span>
                <span style="color: var(--color-terminal-muted);">/</span>
                <span style="color: var(--color-terminal-text);">{g.title}</span>
              </a>
            ))}
          </div>
        </section>

        <!-- By Category -->
        <section>
          <h2 class="font-mono text-xs uppercase tracking-wider mb-4" style="color: var(--color-terminal-comment);">
            By Category
          </h2>
          <div class="grid grid-cols-2 sm:grid-cols-3 gap-2">
            {categories.map((cat) => (
              <a
                href={`/tags/${cat.slug}`}
                class="flex items-center justify-between px-3 py-2 rounded font-mono text-sm transition-colors hover:bg-[--color-terminal-surface]"
                style="color: var(--color-terminal-text);"
              >
                <span>{cat.name}</span>
                <span class="text-xs" style="color: var(--color-terminal-muted);">{cat.count}</span>
              </a>
            ))}
          </div>
        </section>
      </div>

      <!-- Sidebar -->
      <aside class="space-y-6">
        <!-- API Box -->
        <div class="p-4 rounded-lg" style="background: var(--color-terminal-surface); border: 1px solid var(--color-terminal-border);">
          <h3 class="font-mono text-xs uppercase tracking-wider mb-3" style="color: var(--color-terminal-comment);">
            API Access
          </h3>
          <code class="block font-mono text-xs p-2 rounded mb-3" style="background: var(--color-terminal-bg); color: var(--color-terminal-muted);">
            GET /api/v1/manifest.json
          </code>
          <a href="/api" class="font-mono text-xs text-[--color-primary-400] hover:underline">
            View API docs →
          </a>
        </div>

        <!-- Stats -->
        <div class="p-4 rounded-lg" style="background: var(--color-terminal-surface); border: 1px solid var(--color-terminal-border);">
          <h3 class="font-mono text-xs uppercase tracking-wider mb-3" style="color: var(--color-terminal-comment);">
            Stats
          </h3>
          <dl class="space-y-2 font-mono text-sm">
            <div class="flex justify-between">
              <dt style="color: var(--color-terminal-muted);">Guidelines</dt>
              <dd style="color: var(--color-terminal-text);">{stats.guidelines}</dd>
            </div>
            <div class="flex justify-between">
              <dt style="color: var(--color-terminal-muted);">Frameworks</dt>
              <dd style="color: var(--color-terminal-text);">{stats.frameworks}</dd>
            </div>
            <div class="flex justify-between">
              <dt style="color: var(--color-terminal-muted);">Tags</dt>
              <dd style="color: var(--color-terminal-text);">{stats.tags}</dd>
            </div>
          </dl>
        </div>

        <!-- Contribute -->
        <div class="p-4 rounded-lg" style="background: var(--color-terminal-surface); border: 1px solid var(--color-terminal-border);">
          <h3 class="font-mono text-xs uppercase tracking-wider mb-3" style="color: var(--color-terminal-comment);">
            Contribute
          </h3>
          <p class="font-mono text-xs mb-3" style="color: var(--color-terminal-muted);">
            Add or improve guidelines via GitHub.
          </p>
          <a
            href="https://github.com/erold-dev/erold.guide"
            class="inline-flex items-center gap-2 font-mono text-xs text-[--color-primary-400] hover:underline"
          >
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z" />
            </svg>
            GitHub →
          </a>
        </div>
      </aside>
    </div>
  </div>
</BaseLayout>
