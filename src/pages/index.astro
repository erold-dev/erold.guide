---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getTopics, getGuidelines, getGuidelinesByTopic } from '../lib/content';

const allTopics = getTopics();
const allGuidelines = getGuidelines();

const topics = allTopics.map(topic => ({
  ...topic,
  guidelinesCount: getGuidelinesByTopic(topic.slug).length,
}));

const recentGuidelines = allGuidelines
  .sort((a, b) => new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime())
  .slice(0, 5);

const stats = {
  guidelines: allGuidelines.length,
  topics: allTopics.length,
};
---

<BaseLayout title="Development Guidelines">
  <div class="mx-auto max-w-5xl px-4 sm:px-6">

    <!-- HERO SECTION -->
    <section class="hero">
      <h1 class="hero-title">
        Development Guidelines<br />
        <span class="text-gradient">for Every Framework</span>
      </h1>

      <p class="hero-subtitle">
        The open encyclopedia of best practices. Curated guidelines for modern development,
        accessible to humans and AI agents.
      </p>

      <!-- Stats integrated into hero -->
      <div class="flex items-center justify-center gap-6 mt-8 text-lg">
        <div class="flex items-center gap-2">
          <span class="font-mono font-bold" style="color: var(--text-primary);">{stats.guidelines}</span>
          <span style="color: var(--text-secondary);">guidelines</span>
        </div>
        <span style="color: var(--border-primary);">·</span>
        <div class="flex items-center gap-2">
          <span class="font-mono font-bold" style="color: var(--text-primary);">{stats.topics}</span>
          <span style="color: var(--text-secondary);">topics</span>
        </div>
        <span style="color: var(--border-primary);">·</span>
        <div class="flex items-center gap-2">
          <svg class="w-5 h-5" style="color: var(--color-success);" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <span style="color: var(--text-secondary);">100% Free</span>
        </div>
      </div>
    </section>

    <!-- SEARCH -->
    <section class="mb-16">
      <div class="search-box max-w-2xl mx-auto">
        <label for="homepage-search" class="sr-only">Search guidelines</label>
        <input
          type="search"
          id="homepage-search"
          class="search-input"
          placeholder="Search guidelines, topics..."
          aria-describedby="search-hint"
        />
        <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
        <div class="search-shortcut">
          <kbd class="kbd">⌘</kbd>
          <kbd class="kbd">K</kbd>
        </div>
      </div>
      <p id="search-hint" class="text-center mt-3 text-sm" style="color: var(--text-muted);">
        Or press <kbd class="kbd">⌘</kbd> <kbd class="kbd">K</kbd> anywhere
      </p>
    </section>

    <!-- TOPICS -->
    <section class="zone mb-16" aria-labelledby="topics-heading">
      <div class="zone-header">
        <div class="zone-title">
          <div class="zone-icon" aria-hidden="true">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
            </svg>
          </div>
          <h2 id="topics-heading">Topics</h2>
          <span class="zone-count" aria-label="{topics.length} topics">{topics.length}</span>
        </div>
        <a href="/topics" class="zone-link">
          View all<span class="sr-only"> topics</span> →
        </a>
      </div>

      <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
        {topics.map((topic) => (
          <a
            href={`/topics/${topic.slug}`}
            class="framework-card"
            aria-label={`${topic.name} - ${topic.guidelinesCount} guidelines`}
          >
            <div class="framework-card-header">
              <div class="framework-card-icon">
                {topic.logo ? (
                  <img src={topic.logo} alt="" aria-hidden="true" />
                ) : (
                  <span class="text-lg font-bold" style="color: var(--text-primary);" aria-hidden="true">
                    {topic.name.charAt(0)}
                  </span>
                )}
              </div>
              <div>
                <div class="framework-card-title">{topic.name}</div>
                {topic.technology && (
                  <div class="framework-card-tech">{topic.technology}</div>
                )}
              </div>
            </div>
            <p class="framework-card-desc">{topic.description}</p>
            <div class="framework-card-footer">
              <div class="framework-card-stat">
                <span class="framework-card-stat-value">{topic.guidelinesCount}</span>
                <span class="framework-card-stat-label">guidelines</span>
              </div>
              <svg class="w-5 h-5" style="color: var(--text-muted);" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </div>
          </a>
        ))}
      </div>
    </section>

    <!-- RECENT GUIDELINES -->
    <section class="zone mb-16" aria-labelledby="recent-heading">
      <div class="zone-header">
        <div class="zone-title">
          <div class="zone-icon" aria-hidden="true">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
          </div>
          <h2 id="recent-heading">Recent Guidelines</h2>
        </div>
      </div>

      {recentGuidelines.length > 0 ? (
        <ul class="space-y-1" role="list">
          {recentGuidelines.map((g, i) => (
            <li>
              <a href={`/guidelines/${g.topic}/${g.category}/${g.slug}`} class="guideline-card">
                <div class="guideline-card-number" aria-hidden="true">{i + 1}</div>
                <div class="guideline-card-content">
                  <div class="guideline-card-title">{g.title}</div>
                  <div class="guideline-card-meta">
                    <span class="guideline-card-framework">{g.topic}</span>
                    <span class="guideline-card-category">{g.category.replace(/-/g, ' ')}</span>
                  </div>
                </div>
                <svg class="guideline-card-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
              </a>
            </li>
          ))}
        </ul>
      ) : (
        <div class="empty-state">
          <div class="empty-state-icon" aria-hidden="true">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
          </div>
          <div class="empty-state-title">No guidelines yet</div>
          <div class="empty-state-desc">Be the first to contribute a guideline to the encyclopedia.</div>
          <a href="/contribute" class="btn btn-primary mt-4">
            Contribute
          </a>
        </div>
      )}
    </section>

    <!-- API CTA -->
    <section class="mb-16" aria-labelledby="api-heading">
      <div class="surface-elevated">
        <div class="grid md:grid-cols-2 gap-8 items-center">
          <div>
            <h2 id="api-heading" class="text-2xl font-bold mb-3" style="color: var(--text-primary);">
              Built for AI Agents
            </h2>
            <p class="mb-6" style="color: var(--text-secondary);">
              Access all guidelines programmatically through our JSON API.
              Pre-indexed, predictable URLs, zero authentication required.
            </p>
            <a href="/api" class="btn btn-primary">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
              </svg>
              API Documentation
            </a>
          </div>
          <div class="hidden md:block">
            <div class="terminal-window" aria-hidden="true">
              <div class="terminal-header">
                <div class="terminal-dot terminal-dot-red"></div>
                <div class="terminal-dot terminal-dot-yellow"></div>
                <div class="terminal-dot terminal-dot-green"></div>
                <span class="ml-3 text-xs font-mono" style="color: var(--text-muted);">terminal</span>
              </div>
              <div class="terminal-body">
                <div style="color: var(--text-muted);"># Fetch all topics</div>
                <div><span style="color: var(--color-accent-400);">curl</span> <span style="color: var(--color-primary-400);">erold.guide/api/v1/topics.json</span></div>
                <div class="mt-3" style="color: var(--text-muted);"># Get Next.js guidelines</div>
                <div><span style="color: var(--color-accent-400);">curl</span> <span style="color: var(--color-primary-400);">erold.guide/api/v1/topics/nextjs/</span></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

  </div>

  <script>
    // Connect homepage search to global search
    const homepageSearch = document.getElementById('homepage-search');
    homepageSearch?.addEventListener('focus', () => {
      // Trigger the global search modal
      const event = new KeyboardEvent('keydown', {
        key: 'k',
        metaKey: true,
        bubbles: true
      });
      document.dispatchEvent(event);
      homepageSearch.blur();
    });
  </script>
</BaseLayout>
